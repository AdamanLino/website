<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="shortcut icon" href="../assets/imgs/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="obterDados()">

    <div class="dashboard-header">
        <div class="texto-header">
            <p>DASHBOARD - TELA DE MONITORAMENTO</p>
        </div>
        <div class="botao-sair-dash">
            <a href="../index.html">
                <p>Sair</p>
            </a>
        </div>
    </div>

    <div class="sidebar">
        <img src="../assets/imgs/logo.png" alt="logo.png">
        <p>Dashboard</p>

        <div class="botao-sidebar-selecionado">
            <a href="dashboard.html">
                <p>Monitoramento</p>
            </a>
        </div>

        <div class="botao-sidebar">
            <a href="dashboard-questionario.html">
                <p>Questionários</p>
            </a>
        </div>
    </div>

    <div class="container-kpi">
        <div class="kpi-dash">
            <div class="header-kpi">
                <p>Header</p>
            </div>
            <div class="caixa-1">
                membros online
            </div>
            <div class="caixa-2">
                membros banidos
            </div>
            <div class="caixa-3">
                moderadores
            </div>
        </div>
    </div>

    <!-- GRÁFICOS -->
    <div class="graficos-pai-principal">
        <div class="graficos-container">
            <div class="pizza">
                <div class="header-pizza">Postagens mais populares</div>
                <canvas id="graficoPizza">
                </canvas>
            </div>
        </div>

        <div class="graficos-container2">
            <div class="barras">
                <div class="header-barras">Total de mensagens por usuário</div>
                <canvas id="graficoBarras">
                </canvas>
            </div>
        </div>
    </div>

    <div class="graficos-pai-secundario">
        <div class="graficos-container3">
            <div class="linha">
                <div class="header-linha">Novas Postagens</div>
                <canvas id="graficoLinha">
                </canvas>
            </div>
        </div>
        <div class="graficos-container3">
            <div class="linha2">
                <div class="header-linha">Novas Mensagens</div>
                <canvas id="graficoLinha2">
                </canvas>
            </div>
        </div>
    </div>

</body>

</html>

<script>
    // Função chamada ao carregar a página para obter e processar os dados
    function obterDados() {
        // Aqui seria a função que obteria os dados do banco de dados
        fetch('/mensagens/ultimas/')
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                plotarGrafico(data); // Passando os dados corretamente para a função plotarGrafico
            })
            .catch(function (err) {
                console.log(err);
            });
    }

    // Função para plotar o gráfico com os dados
    function plotarGrafico(dados) {
        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para o gráfico de pizza
        let labels = [];
        let dadosGrafico = [];

        // Inserindo valores recebidos em estrutura para o gráfico
        for (let i = 0; i < dados.length; i++) {
            let registro = dados[i];
            labels.push(registro.assunto);  // Usando 'assunto' como label
            dadosGrafico.push(registro.total_mensagens);  // Contagem de mensagens
        }

        console.log('O gráfico será plotado com os seguintes valores:');
        console.log('Labels:', labels);
        console.log('Dados:', dadosGrafico);

        // Configurando o gráfico de pizza
        const config = {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Postagens Mais Populares',
                    data: dadosGrafico,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(153, 102, 255, 0.5)',
                        'rgba(255, 159, 64, 0.5)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true
            }
        };

        // Plotando o gráfico de pizza no canvas
        let myChart = new Chart(
            document.getElementById('graficoPizza'),  // Referência para o canvas
            config
        );
    }

</script>
<!-- Chamando os gráficos -->
<!-- <script src="../js/pizza.js"></script> -->
<script src="../js/barras.js"></script>
<script src="../js/linhas.js"></script>
<script src="../js/linhas2.js"></script>