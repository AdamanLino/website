<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="shortcut icon" href="../assets/imgs/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="obterDados()">

    <div class="dashboard-header">
        <div class="texto-header">
            <p>DASHBOARD - TELA DE MONITORAMENTO</p>
        </div>
        <div class="botao-sair-dash">
            <a href="../index.html">
                <p>Sair</p>
            </a>
        </div>
    </div>

    <div class="sidebar">
        <img src="../assets/imgs/logo.png" alt="logo.png">
        <p>Dashboard</p>

        <div class="botao-sidebar-selecionado">
            <a href="dashboard.html">
                <p>Monitoramento</p>
            </a>
        </div>

        <div class="botao-sidebar">
            <a href="dashboard-questionario.html">
                <p>Questionários</p>
            </a>
        </div>
    </div>

    <div class="container-kpi">
        <div class="kpi-dash">
            <div class="header-kpi">
                <p>Header</p>
            </div>
            <div class="caixa-1">
                membros online
            </div>
            <div class="caixa-2">
                membros banidos
            </div>
            <div class="caixa-3">
                moderadores
            </div>
        </div>
    </div>

    <!-- GRÁFICOS -->
    <div class="graficos-pai-principal">
        <div class="graficos-container">
            <div class="pizza">
                <div class="header-pizza">Postagens mais populares</div>
                <canvas id="graficoPizza">
                </canvas>
            </div>
        </div>

        <div class="graficos-container2">
            <div class="barras">
                <div class="header-barras">Total de mensagens por usuário</div>
                <canvas id="graficoBarras">
                </canvas>
            </div>
        </div>
    </div>

    <div class="graficos-pai-secundario">
        <div class="graficos-container3">
            <div class="linha">
                <div class="header-linha">Novas Postagens</div>
                <canvas id="graficoLinha">
                </canvas>
            </div>
        </div>
        <div class="graficos-container3">
            <div class="linha2">
                <div class="header-linha">Novas Mensagens</div>
                <canvas id="graficoLinha2">
                </canvas>
            </div>
        </div>
    </div>

</body>

</html>

<script>
    // Função chamada ao carregar a página para obter e processar os dados
    function obterDados() {
        // Aqui seria a função que obteria os dados do banco de dados
        // No caso, aqui você colocaria o fetch que teria o endereço da sua rota que você criou na pasta /routes e chamaria a função plotarGraficoLinha nessa função. Exemplo:
        fetch('/mensagens/ultimas/')
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                plotarGraficoLinha(data);
                plotarGraficoBarra(data);
            })
            .catch(function (err) {
                console.log(err);
            })

        // Como eu não configurei as rotas, eu criei um array com os dados para simular a obtenção dos dados
        var dados = [{
            jogador: 'Endrick',
            votos: 10
        },
        {
            jogador: 'João',
            votos: 5
        },
        {
            jogador: 'Maria',
            votos: 15
        },
        {
            jogador: 'José',
            votos: 20
        },
        {
            jogador: 'Pedro',
            votos: 25
        },
        {
            jogador: 'Ana',
            votos: 30
        }]

        // Chamando a função para plotar o gráfico de linha com os dados
        plotarGraficoLinha(dados);
        // Chamando a função para plotar o gráfico de barra com os dados
        plotarGraficoBarra(dados)
    }

    // Função para plotar o gráfico de linha
    function plotarGraficoLinha(dados) {

        // Separando os rótulos (labels) e os dados dos votos
        var votos = [];
        var jogadores = [];

        // Preenchendo os arrays com os dados
        for (var i = 0; i < dados.length; i++) {
            votos.push(dados[i].votos);
            jogadores.push(dados[i].jogador);
        }

        // Capturando o elemento canvas pelo id 
        var ctx = document.getElementById('linha').getContext('2d');
        // Criando o gráfico de linha usando o Chart.js
        var myChart = new Chart(ctx, {
            type: 'line', // Tipo de gráfico: linha
            data: { // Dados para o gráfico
                labels: jogadores, // Rótulos no eixo X
                datasets: [{
                    label: 'Votos', // Nome do conjunto de dados
                    data: votos, // Dados dos votos
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)', // Cor de fundo das linhas
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)', // Cor da borda das linhas
                    ],
                    borderWidth: 1 // Largura da borda das linhas
                }]
            },
        });
    }

    // Função para plotar o gráfico de barra
    function plotarGraficoBarra(dados) {

        var votos = [];
        var jogadores = [];

        // Preenchendo os arrays com os dados
        for (var i = 0; i < dados.length; i++) {
            votos.push(dados[i].votos);
            jogadores.push(dados[i].jogador);
        }

        // Capturando o elemento canvas pelo id 
        var ctx = document.getElementById('barra').getContext('2d');
        // Criando o gráfico de barra usando o Chart.js
        var myChart = new Chart(ctx, {
            type: 'bar', // Tipo de gráfico: barra
            data: { // Dados para o gráfico
                labels: jogadores, // Rótulos no eixo X
                datasets: [{
                    label: 'Votos', // Nome do conjunto de dados
                    data: votos, // Dados dos votos
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)', // Cor de fundo das barras
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)', // Cor da borda das barras
                    ],
                    borderWidth: 1 // Largura da borda das barras
                }]
            },
        });
    }
</script>

<!-- Chamando os gráficos -->
<script src="../js/pizza.js"></script>
<script src="../js/barras.js"></script>
<script src="../js/linhas.js"></script>
<script src="../js/linhas2.js"></script>